# SHACL_SD1002.TTL
# Constraints for FDA Rule SD1002 
#
@prefix study: <https://w3id.org/phuse/study#> .
@prefix sh:   <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

study:SD1002Shape rdf:type sh:NodeShape ;
  sh:targetClass study:AnimalSubject ;

  #--- Test 1: Check Format ----
  # a. RFSTDTC format
  sh:property [
    sh:path study:rfstdtc ;
    sh:message "Data error: RFENDTC is not in date or dateTime format." ;
    sh:or (
      [sh:datatype xsd:date ; ]
      [sh:datatype xsd:dateTime ; ]
    ) 
  ] ;

  # b. RFENDTC format
  sh:property [
    sh:path study:rfendtc ;
    sh:message "Data error: RFENDTC is not in date or dateTime format." ;
    sh:or (
      [sh:datatype xsd:date ; ]
      [sh:datatype xsd:dateTime ; ]
    ) 
  ] ;

  #---- Test 2: Date Count Violations  -----
  # a. RFSTDTC Count
  sh:property [
    sh:path study:rfstdtc; 
    sh:minCount 1 ;
    sh:maxCount 1 ;
    sh:message "Data error: RFSTDTC Min/Max count "
  ] ; 
 # b. RFENDTC Count
  sh:property [
    sh:path study:rfendtc; 
    sh:minCount 1 ;
    sh:maxCount 1 ;
    sh:message "Data error: RFENDTC Min/Max count "
  ] ;

  #---- Test 3: SD1002 Rule: Start date less or equal to end Date  -----
  sh:property [
    sh:path      study:rfstdtc ;
    sh:lessThanOrEquals  study:rfendtc ;
    sh:message "SD1002: RFSTDTC is after RFENDTC." 
  ]
  .
