# SHACL_SD1002.TTL
# Validate FDA Rule SD1002 : RFSTDTC less than or equal to RFENDTC
#
@prefix study: <https://w3id.org/phuse/study#> .
@prefix sh:   <http://www.w3.org/ns/shacl#> .

study:SubjectShape a sh:Shape;
  sh:targetClass study:AnimalSubject;
  sh:node        study:SD1002Shape .

study:SD1002Shape rdf:type sh:NodeShape ;
 
  sh:property [
    sh:name "Date format and count" ;
    sh:description "Evaluate date format (xsd:date/ xsd:dateTime) and minCount, maxCount = 1 per AnimalSubject." ;
    sh:path study:rfstdtc; 
    sh:or (
      [sh:datatype  xsd:date ; ]
      [sh:datatype  xsd:dateTime ; ]
    ) ;
    sh:minCount 1 ;
    sh:maxcount 1 ;
  ] ; 

 sh:property [
    sh:name "Date format and count" ;
    sh:description "Evaluate date format (xsd:date/ xsd:dateTime) and minCount, maxCount = 1 per AnimalSubject." ;
    sh:path study:rfendtc; 
    sh:or (
      [sh:datatype  xsd:date ; ]
      [sh:datatype  xsd:dateTime ; ]
    ) ;
    sh:minCount 1 ;
    sh:maxcount 1 ;
  ] ; 

  sh:property [
    sh:name "SD1002" ;
    sh:description "SD1002: Subject Reference Start Date/Time (RFSTDTC) must be less than or equal to Subject Reference End Date/Time (RFENDTC)" ;
    sh:path             study:rfstdtc ;
    sh:lessThanOrEquals study:rfendtc ;
    sh:message "RFSTDTC is after RFENDTC." 
  ].
